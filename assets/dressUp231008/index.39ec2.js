window.__require=function e(t,i,s){function n(a,c){if(!i[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!c&&h)return h(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){return n(t[a][1][e]||e)},d,d.exports,e,t,i,s)}return i[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<s.length;a++)n(s[a]);return n}({DressUpItem:[function(e,t){"use strict";cc._RF.push(t,"26577Zdu2FNOYVuTyh2Em+Z","DressUpItem");var i=e("StorageModule"),s=e("LoadResModule"),n=e("GameControl"),o=e("GameCommon"),a=e("LanguageModule"),c=e("AdInfo"),r=e("StatisticsModule");cc.Class({extends:cc.Component,properties:{selectedNode1:cc.Node,selectedNode2:cc.Node,image:cc.Sprite,lockNode:cc.Node},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this._moveFlag=!1,this.lastPos=new cc.v2(0,0)},initItem:function(e,t){if(this.index=e,this.selectedNode1.active=!1,this.selectedNode2.active=!1,this.lockNode.active=!1,this.image.spriteFrame=null,0!=e||t){if(this.id=t.id,this.itemType=t.itemType,this.itemCount=t.itemCount,this.lockFlag=t.lockFlag,!n.isTest)if(2==this.lockFlag){var s="petal"+n.getIndexBySkinName(this.itemType);2!=i.getData(s)&&(this.lockNode.active=!0,this.lockNode.getComponent(cc.Sprite).spriteFrame=n.curScene.lockImage[1])}else if(isHasAd&&1==this.lockFlag){var o=i.getData(this.id.toString());n.unlockCatItem||o||(this.lockNode.active=!0,this.lockNode.getComponent(cc.Sprite).spriteFrame=n.curScene.lockImage[0])}this.loadImage(this.id)}else this.id=-1,this.itemCount=null,this.image.spriteFrame=n.curScene.clearImage;n.curScene.curDressUp[n.curScene.categoryType]||0!=this.index?n.curScene.curDressUp[n.curScene.categoryType]==this.id&&(this.selectedNode1.active=!0,this.selectedNode2.active=!0,n.curScene.curItem=this):(this.selectedNode1.active=!0,this.selectedNode2.active=!0,n.curScene.curItem=this)},onTouchBegan:function(e){this._moveFlag=!1,this.lastPos=e.touch.getLocation()},onTouchMove:function(e){var t=e.touch.getLocation();0==this._moveFlag&&Math.abs(t.x-this.lastPos.x)>5&&Math.abs(t.y-this.lastPos.y)>5&&(this._moveFlag=!0)},onTouchEnd:function(e){var t=e.touch.getLocation();if(0==this._moveFlag&&Math.abs(t.x-this.lastPos.x)<=5&&Math.abs(t.y-this.lastPos.y)<=5){if(1==this.lockNode.active){if(!o.isCanClick())return;if(1==this.lockFlag){var s=this;c.adsManager.showVideo("dressUpItem",function(e){if(e){s.lockNode.active=!1,i.setData(s.id.toString(),1);var t=n.getCategoryTypeById(s.id);r.eventStatistics("dressUp"+t)}})}else if(2==this.lockFlag){var h="\u83b7\u5f97&1\u4ee5\u89e3\u9501\u6b64\u90e8\u4ef6";h=(h=a.translateString(h)).replace("&1",this.itemType),n.remindPanelCtrl.showSimpleRemind(h,!1)}return}null!=n.curScene.curItem&&(n.curScene.curItem.selectedNode1.active=!1,n.curScene.curItem.selectedNode2.active=!1),n.curScene.curDressUp[n.curScene.categoryType]=this.id,n.curScene.curItem=this,this.selectedNode1.active=!0,this.selectedNode2.active=!0,-1==this.id?n.changePartImage(n.curScene.cat,n.curScene.categoryType):(n.curScene.categoryType==n.dressUpType.skin?n.curScene.cat.setSkin(this.itemType):n.changePartImage(n.curScene.cat,n.curScene.categoryType,"","parts/",this.itemCount),n.curScene.playAnimation())}this._moveFlag=!1},loadImage:function(e){var t="partsIcon/"+e;if(isOnline){var i=serverPath+t+".png";s.loadRes(i,function(e){this.image.spriteFrame=new cc.SpriteFrame(e)}.bind(this))}else s.loadLocalRes(t,function(e){console.log(e),this.image.spriteFrame=e}.bind(this),cc.SpriteFrame)}}),cc._RF.pop()},{AdInfo:void 0,GameCommon:void 0,GameControl:void 0,LanguageModule:void 0,LoadResModule:void 0,StatisticsModule:void 0,StorageModule:void 0}],DressUpScrollView:[function(e,t){"use strict";cc._RF.push(t,"4a86cR5oE9FeLd8nedbXvPR","DressUpScrollView");var i=e("StorageModule"),s=e("GameControl");cc.Class({extends:cc.Component,properties:{maxSize:6,frontNum:2,backNum:2,unitNum:3,sideSpace:20,itemSpaceH:100,itemSpaceW:100,itemPrefab:cc.Prefab,separateFrame:cc.SpriteFrame},onLoad:function(){this.startPos=0,this.node.on("initScrollView",this.initScrollView,this),this.node.parent.parent.getComponent(cc.ScrollView).vertical?this.diretorFlag=!0:this.diretorFlag=!1},start:function(){},initScrollView:function(e){void 0===e&&(e=!0),this.isHasClear=e;for(var t=new Array,n=0;n<s.itemMsg.length;n++)(3!=s.itemMsg[n].lockFlag||i.getData(s.evaluateId))&&s.getCategoryTypeById(s.itemMsg[n].id)==s.curScene.categoryType&&t.push(s.itemMsg[n]);this.loadData(t)},loadData:function(e){this.jsonMsg=e,this.curDex=0,this.isHasClear?this.maxDex=Math.floor((this.jsonMsg.length-1+1)/this.unitNum)*this.unitNum:this.maxDex=Math.floor((this.jsonMsg.length-1)/this.unitNum)*this.unitNum;var t=this.jsonMsg.length+(this.isHasClear?1:0),i=this.node.getChildByName("UI");i||((i=new cc.Node).parent=this.node,i.name="UI");for(var s=i.children,n=Math.ceil(t/this.unitNum),o=0;o<n;o++){var a=s[o];a||((a=new cc.Node).parent=i,a.anchorY=0,a.addComponent(cc.Sprite).spriteFrame=this.separateFrame)}for(var c=n;c<s.length;c++)s[c].destroy();for(var r=this.getChildBySiblingIndex(),h=0;h<r.length;h++)r[h].active=!1;for(var d=this.curDex;d<this.unitNum*this.maxSize&&d<this.jsonMsg.length+this.isHasClear;d++)this.initItemMsg(d,r[d-this.curDex]);t-this.curDex>=this.unitNum*(this.maxSize-1)?this.bottomIndex=this.unitNum*(this.maxSize-1):this.bottomIndex=this.unitNum*(Math.ceil(t/this.unitNum)-1),1==this.diretorFlag?this.node.y=this.startPos:this.node.x=this.startPos,this.lastIndex=0,this.topIndex=0,s=i.children;for(var l=0;l<n;l++)s[l].y=-this.sideSpace-(this.itemH+this.itemSpaceH)*(l+1)},getChildBySiblingIndex:function(){for(var e=[],t=this.node.children,i=0;i<t.length;i++)0!=t[i].getSiblingIndex()&&e.push(t[i]);return e},initItemMsg:function(e,t){var i=null;t?i=t:(i=cc.instantiate(this.itemPrefab)).parent=this.node,i.active=!0;var s=i.getComponent("DressUpItem");if(this.isHasClear?0==e?s.initItem(e):s.initItem(e,this.jsonMsg[e-1]):s.initItem(e,this.jsonMsg[e]),0==e){this.itemW=i.width,this.itemH=i.height;var n=Math.ceil((this.jsonMsg.length+(this.isHasClear?1:0))/this.unitNum);if(1==this.diretorFlag){var o=(this.itemH+this.itemSpaceH)*n+this.sideSpace;this.node.height=o,this.node.width=this.unitNum*(this.itemW+this.itemSpaceW)-this.itemSpaceW}else{var a=(this.itemW+this.itemSpaceW)*n+this.sideSpace;this.node.width=a,this.node.height=this.unitNum*(this.itemH+this.itemSpaceH)-this.itemSpaceH}}if(1==this.diretorFlag){var c=-this.sideSpace-this.itemH/2-Math.floor(e/this.unitNum)*(this.itemH+this.itemSpaceH),r=-this.node.width/2+this.itemW/2+e%this.unitNum*(this.itemW+this.itemSpaceW);1==this.unitNum&&(r=0),i.setPosition(r,c)}else{var h=this.sideSpace+this.itemW/2+Math.floor(e/this.unitNum)*(this.itemW+this.itemSpaceW),d=this.node.height/2-this.itemH/2-e%this.unitNum*(this.itemH+this.itemSpaceH);1==this.unitNum&&(d=0),i.setPosition(h,d)}},updateTwoRowItem:function(e){var t=this.getChildBySiblingIndex();if(0==e){var i=t[this.topIndex].getComponent("DressUpItem").index+this.maxSize*this.unitNum;if(i>=this.jsonMsg.length+(this.isHasClear?1:0))return;for(var s=this.topIndex;s<this.topIndex+this.unitNum&&i<this.jsonMsg.length+(this.isHasClear?1:0);s++,i++)this.initItemMsg(i,t[s]);this.bottomIndex=this.topIndex,this.topIndex+=this.unitNum,this.topIndex>(this.maxSize-1)*this.unitNum&&(this.topIndex=0)}else if(1==e){var n=t[this.bottomIndex].getComponent("DressUpItem").index-this.unitNum*this.maxSize;if(n<0)return;for(var o=this.bottomIndex;o<this.bottomIndex+this.unitNum&&n<this.jsonMsg.length+(this.isHasClear?1:0);o++,n++)this.initItemMsg(n,t[o]);this.topIndex=this.bottomIndex,this.bottomIndex-=this.unitNum,this.bottomIndex<0&&(this.bottomIndex=this.unitNum*(this.maxSize-1))}},onScrollRectScrolled:function(){var e=-1;if(this.diretorFlag){if(this.node.y<this.startPos)return;e=Math.floor((this.node.y-this.sideSpace-this.startPos)/(this.itemH+this.itemSpaceH))*this.unitNum}else{if(this.node.x>this.startPos)return;e=Math.floor((this.startPos-this.sideSpace-this.node.x)/(this.itemW+this.itemSpaceW))*this.unitNum}e!=this.lastIndex&&this.updateScrollView(e)},updateScrollView:function(e){if(e<this.lastIndex){if(this.lastIndex=e,e>this.maxDex-this.backNum*this.unitNum)return;this.updateTwoRowItem(1)}else if(e>this.lastIndex){if(this.lastIndex=e,e<this.frontNum*this.unitNum)return;this.updateTwoRowItem(0)}}}),cc._RF.pop()},{GameControl:void 0,StorageModule:void 0}],DressUp:[function(e,t){"use strict";cc._RF.push(t,"4550fGEvE9OTY+WBR7n6m9T","DressUp");var i=e("GameControl"),s=e("StorageModule"),n=e("EngineCommon"),o=e("ObjModule"),a=e("GameCommon"),c=e("AudioModule"),r=e("AdInfo"),h=e("TimeModule");cc.Class({extends:cc.Component,properties:{cat:sp.Skeleton,scrollView:cc.ScrollView,clearImage:cc.SpriteFrame,lockImage:{type:cc.SpriteFrame,default:[]}},onLoad:function(){i.curScene=this,sceneIndex=i.SceneName.dressUp,a.handleEventPerScene()},onDestroy:function(){i.curScene=null},start:function(){var e=this;i.isSave=!1,this.sizeFit(),console.log("displayNum="+i.displayNum+",curCatName="+i.curCatName),-1!=i.displayNum?this.categoryType=i.dressUpType.skin:(this.categoryType=i.dressUpType.clothes,cc.find("Canvas/rightHolder/categoryScrollView/view/content/category"+i.dressUpType.skin).active=!1),i.skeletonData&&(this.cat.skeletonData=n.newSkeletonData(i.skeletonData)),this.curDressUp=[];var t=i.getLocalDressUp(i.curCatName,i.displayNum);i.initDressUp(this.cat,t);for(var s=0;s<t.length;s++){var o=i.getCategoryTypeById(t[s]);this.curDressUp[o]=t[s]}n.spineAnimationPlay(this.cat,"idle",!0),this.categoryType==i.dressUpType.skin?this.scrollView.content.emit("initScrollView",!1):cc.find("Canvas/rightHolder/categoryScrollView/view/content/category"+i.dressUpType.clothes).getComponent(cc.Toggle).isChecked=!0,this.adHandle(),i.hideLoadingPanel(function(){e.sizeFit()})},sizeFit:function(){if(cc.winSize.width/cc.winSize.height<2){var e=cc.find("Canvas/rightHolder/categoryScrollView"),t=e.x-e.width,i=(cc.winSize.width+t)/cc.find("Canvas/holder").width;cc.find("Canvas/holder").scale=i}},adHandle:function(){r.adsManager.hideCustomAd(),isHasAd&&!i.isForbid()&&(bannerShowFlag[sceneIndex]?r.adsManager.showBanner():r.adsManager.hideBanner(),r.adsManager.showInterVideo("dressUp"),r.adsManager.showCustomAd(3))},playAnimation:function(){n.spineAnimationPlay(this.cat,["happy","idle"],!0,!0)},categorySwitch:function(e){this.categoryType=parseInt(e.node.name.substr(e.node.name.length-1,1)),this.categoryType==i.dressUpType.skin?this.scrollView.content.emit("initScrollView",!1):this.scrollView.content.emit("initScrollView")},isChange:function(){if(i.isAdd)return!0;var e=o.simplifiedArr(this.curDressUp),t=i.getLocalDressUp(i.curCatName,i.displayNum);if(t.length!=e.length)return!0;for(var s=!1,n=0;n<e.length;n++)if(t[n]!=e[n]){s=!0;break}return s},saveHandle:function(){var e=o.simplifiedArr(this.curDressUp);if(i.isAdd){var t=s.getJsonData("diyCabinetMsg",[]);t.push(parseInt(i.displayNum)),s.setJsonData("diyCabinetMsg",t)}i.setLocalDressUp(i.curCatName,i.displayNum,e)},btnBack:function(){c.playEffect("click"),this.isChange()?i.remindPanelCtrl.showRemindPanel(3):i.showLoadingPanel(function(){cc.director.loadScene("game")})},btnSave:function(){c.playEffect("click"),this.isChange()&&this.saveHandle(),!i.isForbid()&&h.getCurrentDate()>s.getData("firstLoginDate")&&(i.isSave=!0),i.showLoadingPanel(function(){cc.director.loadScene("game")})},btnSet:function(){c.playEffect("click"),i.remindPanelCtrl.showSetPanel()}}),cc._RF.pop()},{AdInfo:void 0,AudioModule:void 0,EngineCommon:void 0,GameCommon:void 0,GameControl:void 0,ObjModule:void 0,StorageModule:void 0,TimeModule:void 0}]},{},["DressUp","DressUpItem","DressUpScrollView"]);